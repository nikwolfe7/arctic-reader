<!DOCTYPE html>
<html>
<head>
<title>Arctic Reader</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<link rel="icon" href="https://raw.githubusercontent.com/twitter/twemoji/master/assets/svg/1f976.svg">
<link rel="stylesheet" href="stylesheet.css">
<script type="text/javascript" src="questions_data.json"></script>
<script type="module">
    
function loadJSON(callback) {
    var xobj = new XMLHttpRequest();
    xobj.overrideMimeType("application/json");
    xobj.open('GET', 'https://www.arctic-reader.com/questions_data.json', true);
    xobj.onreadystatechange = function () {
        if (xobj.readyState == 4 && xobj.status == "200") {
            // Required use of an anonymous callback as .open will NOT return a value but simply returns undefined in asynchronous mode
            callback(xobj.responseText);
        }
    };
    xobj.send(null);
}

function init() {
    loadJSON(function (response) {
        // Parsing JSON string into object
        var questions = JSON.parse(response);
    });
}

init();

console.log("Loaded Questions array with: " + questions.length + " elements.");	

var i = 0;
var j = 0; 

function boundsCheck() {
    i = Math.min(Math.max(i, 0), questions.length - 1);
    j = Math.min(Math.max(j, 0), questions[i].data.length - 1);
}

function setTextFields() {
    boundsCheck();        
    let title = questions[i].title,
        text = questions[i].data[j];
    
    console.log("Displaying element title " + i + ": " + title);
    console.log("Displaying element text " + j + ": " + text);
    
    document.getElementById('titlebox').innerHTML = title;
    document.getElementById('txtbox').innerHTML = text;
}

function nextQuestion() {
    boundsCheck();
    i = ++i >= questions.length ? 0 : i;
    j = 0;
}

function prevQuestion() {
    boundsCheck();
    i = --i < 0 ? questions.length - 1 : i;
    j = 0;
}

function randQuestion() {
    i = Math.floor(Math.random() * questions.length);
    j = 0;
}

function nextItem() {
    boundsCheck();
    /* data items exceeded, proceed to next question */ 
    if (++j >= questions[i].data.length) {
        nextQuestion();
    }
}

// initialize
setTextFields();

/* Keyboard + laptop */
document.onkeydown = function(e) {
    /* space bar */
    if (e.keyCode == 32) {
        console.log("Space Bar Key Event");
        nextItem();
        setTextFields();
    }
	/* right arrow, or up arrow */
    else if (e.keyCode == 38 || e.keyCode == 39) {
        console.log("Forward Key Event");
        nextQuestion();
        setTextFields();
    }
    /* left arrow or down arrow */
    else if (e.keyCode == 37 || e.keyCode == 40) { // backward
        console.log("Backward Key Event");
        prevQuestion();
        setTextFields();
    }
    /* letter R */
    else if (e.keyCode == 82) { // random
		console.log("Random Key Event");
        randQuestion();
        setTextFields();
    }
}

/* Mobile touch screen */
document.body.addEventListener("touchend", function() {
	console.log("Touch End Event");
	nextItem();
	setTextFields();
});

</script>
</head>
<body>
<div class="container">
    <span id="titlebox" class="title_display"></span>
    <span id="txtbox" class="text_display"></span>
</div>
</body>
</html>